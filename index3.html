<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Web 3 Demo</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.0/web3.min.js'></script>
    <script>
        async function loadWeb3() {
            if (window.ethereum) { 
                window.web3 = new Web3(window.ethereum);
                window.ethereum.enable();
            }
        }
        async function load() {
            await loadWeb3();
            window.contract = await loadContract();
            updateStatus('Ready!');
        }
        function updateStatus(status) {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = status;
            console.log(status);
        }
        
        async function loadContract() {
            return await new window.web3.eth.Contract([
	{
		"constant": false,
		"inputs": [
			{
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "approveRequest",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "contribute",
		"outputs": [],
		"payable": true,
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "description",
				"type": "string"
			},
			{
				"name": "value",
				"type": "uint256"
			},
			{
				"name": "recipient",
				"type": "address"
			}
		],
		"name": "createRequest",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "finalizeRequest",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"name": "minimum",
				"type": "uint256"
			},
			{
				"name": "creator",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "approversCount",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getRequestsCount",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getSummary",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "manager",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "minimumContribution",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "requests",
		"outputs": [
			{
				"name": "description",
				"type": "string"
			},
			{
				"name": "value",
				"type": "uint256"
			},
			{
				"name": "recipient",
				"type": "address"
			},
			{
				"name": "complete",
				"type": "bool"
			},
			{
				"name": "approvalCount",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
], '0x680d3da45577032084a72B84F106acf8446D8C32');  // Campaign
        }
	
	/*async function printCoolNumber() {
    		updateStatus('fetching Cool Number...');
    		const coolNumber = await window.contract.methods.coolNumber().call();
    		updateStatus(`coolNumber: ${coolNumber}`);
	} */
	    
	async function printCoolNumber() {
		updateStatus('fetching Cool Number...');
		const summary = await window.contract.methods.getSummary.call();

    		updateStatus(`coolNumber: ${summary[4]}`);
	}	
	    
	/*async function loadMetamask() {
    		const value = Math.floor(Math.random() * 100); //después de una redirección acá hacer un get de localstorage del nuevo bloque y guardarlo
    		updateStatus(`Conectando con Metamask para realizar la Transacción :  ${value}`);
    		const account = await getCurrentAccount();
    		const coolNumber = await window.contract.methods.setCoolNumber(value).send({ from: account });
    		updateStatus('ok.');
                // window.location.href = "https://notarix.herokuapp.com/certificar2";
	} 
	    
	 async function changeCoolNumber() {
            const value = Math.floor(Math.random() * 100); //después de una redirección acá hacer un get de localstorage del nuevo bloque y guardarlo
            updateStatus(`Updating coolNumber with ${value}`);
            const account = await getCurrentAccount();
            const coolNumber = await window.contract.methods.setCoolNumber(value).send({ from: account });
            updateStatus('Updated.');
        }   */ 
	    
	async function getCurrentAccount() {
    		const accounts = await window.web3.eth.getAccounts();
    		return accounts[0];
	}    
	    
	load();    
    </script>
</head>
<body onload="" style="font-family: helvetica; color: gray"; >
      Web 3 Demo
    <br >
    <button onclick="printCoolNumber();">Print Cool Number</button>
    <button onclick="changeCoolNumber();">Change Cool Number</button>
    <br /><br />
	Status: <span id="status">Loading...</span><br><br>
        Realiza una transacción de 0.1 Eth a Ropsten con metamask* - una vez confirmada la Transacción serás redireccionado para hacer tu registro.
        <br><br> <span style="font-size: 10px">* Requiere Metamask como una extensión de Chrome con la red test de Ethereum Ropsten</span>
        <script type="text/javascript">
        
    </script>
</body>
</html>
